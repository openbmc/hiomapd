{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5539ae48_ee6bbe5a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2024-11-13T23:12:04Z",
      "side": 1,
      "message": "Where there\u0027s a bug, there are new test cases to be written ;)",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c280295_c0040361",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-11-14T19:41:30Z",
      "side": 1,
      "message": "Andrew, I hit this issue when I run it with valgrind command.",
      "parentUuid": "5539ae48_ee6bbe5a",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8598deec_83ed71e9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-11-21T21:12:36Z",
      "side": 1,
      "message": "There are multiple testcase which are creating window and not hitting this issue. I hit it only with valgrind.",
      "parentUuid": "4c280295_c0040361",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4ed1d9fe_1b7bb773",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2024-11-22T00:15:27Z",
      "side": 1,
      "message": "If there are multiple test cases that aren\u0027t hitting the bug, then the test coverage isn\u0027t yet good enough.\n\nIt\u0027s my expectation that if a bug exists then a test should be written to capture the broken behaviour, so the implementation cannot regress undetected in the future.\n\nWhat\u0027s your understanding of unit tests? When should someone write them, and what should they capture?",
      "parentUuid": "8598deec_83ed71e9",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "823ba8a8_21af5975",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-12-07T00:07:46Z",
      "side": 1,
      "message": "Sorry I saw this today.\n\nyes, I am aware of unit testing. Adding valgrind to the unit test may be large effort as compare to the simple logic issue.",
      "parentUuid": "4ed1d9fe_1b7bb773",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c6eb1d2_08183729",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2024-12-09T00:49:27Z",
      "side": 1,
      "message": "I don\u0027t think you need to add valgrind support, but you do need to add a test case that would otherwise trigger the core?\n\nSeparately, you get valgrind support for free in CI if you fix up https://gerrit.openbmc.org/c/openbmc/hiomapd/+/65396",
      "parentUuid": "823ba8a8_21af5975",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae8321cd_06c5ce65",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-12-09T17:04:51Z",
      "side": 1,
      "message": "ok, On rainier system I am hitting SEGV when I run this command.\n\nbusctl call xyz.openbmc_project.Hiomapd /xyz/openbmc_project/Hiomapd xyz.openbmc_project.Hiomapd.Protocol.V2 CreateReadWindow qq 0 1\n\nThere is already testcase to create read window so not sure why it is working in CI and not on real system.\n\nhttps://github.com/openbmc/hiomapd/blob/master/test/create_read_window_v2.c",
      "parentUuid": "4c6eb1d2_08183729",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57fb0373_40959012",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2024-12-10T05:29:55Z",
      "side": 1,
      "message": "Does the test case take the same inputs, including e.g. TOC?",
      "parentUuid": "ae8321cd_06c5ce65",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "99c916d6_ffd40d1b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-12-11T16:28:57Z",
      "side": 1,
      "message": "There is also a testcase to create window with TOC. https://github.com/openbmc/hiomapd/blob/master/vpnor/test/create_read_window_toc.cpp",
      "parentUuid": "57fb0373_40959012",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2089188_bc0bd6e0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-12-11T20:40:31Z",
      "side": 1,
      "message": "ok, I did further investigation.\n\n# If I call CreateReadWindow before calling GetInfo I see the crash.\n++ busctl call xyz.openbmc_project.Hiomapd /xyz/openbmc_project/Hiomapd xyz.openbmc_project.Hiomapd.Protocol.V2 CreateReadWindow qq 0 1\nCall failed: Remote peer disconnected\n\n# I call GetInfo first then I don\u0027t see the call because GetInfo calls windows_alloc_dirty_bytemap() hence we don\u0027t see the issue.\n++ busctl call xyz.openbmc_project.Hiomapd /xyz/openbmc_project/Hiomapd xyz.openbmc_project.Hiomapd.Protocol GetInfo y 2\nyyq 2 12 8\n++ busctl call xyz.openbmc_project.Hiomapd /xyz/openbmc_project/Hiomapd xyz.openbmc_project.Hiomapd.Protocol.V2 CreateReadWindow qq 0 1\nqqq 49152 2 0\n\n# I tried to write testcase without GetInfo call and it failed saying that GetInfo must be called first.\n[ 1733949109.098396932] Received MBOX request:\n[ 1733949109.098399329] MBOX cmd: 4\n[ 1733949109.098401119] MBOX seq: 1\n[ 1733949109.098402377] MBOX arg[0]: 0x00\n[ 1733949109.098403889] MBOX arg[1]: 0x00\n[ 1733949109.098405217] MBOX arg[2]: 0x01\n[ 1733949109.098406523] MBOX arg[3]: 0x00\n[ 1733949109.098407795] MBOX arg[4]: 0x00\n[ 1733949109.098409057] MBOX arg[5]: 0x00\n[ 1733949109.098410324] MBOX arg[6]: 0x00\n[ 1733949109.098411604] MBOX arg[7]: 0x00\n[ 1733949109.098412853] MBOX arg[8]: 0x00\n[ 1733949109.098414103] MBOX arg[9]: 0x00\n[ 1733949109.098415368] MBOX arg[10]: 0x00\n[ 1733949109.098416717] Received MBOX command: 4\n[ 1733949109.098418244] Must call GET_MBOX_INFO before 4\n[ 1733949109.098427057] Translating errno 71: Protocol error\n\nIn check_req_valid() we make sure that map is already allocated.\n        if (!(context-\u003estate \u0026 MAPS_MEM)) {\n                if (cmd !\u003d MBOX_C_RESET_STATE \u0026\u0026 cmd !\u003d MBOX_C_GET_MBOX_INFO\n                                              \u0026\u0026 cmd !\u003d MBOX_C_ACK) {\n                        MSG_ERR(\"Must call GET_MBOX_INFO before %d\\n\", cmd);\n                        return -EPROTO;\n                }\n        }",
      "parentUuid": "99c916d6_ffd40d1b",
      "revId": "6ff2dac9332f7bc466c2fa90639926e9db79088f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}